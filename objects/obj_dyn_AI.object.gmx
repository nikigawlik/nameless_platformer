<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>spr_32</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>obj_fighter</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>event_inherited()

randomize()

if !instance_exists(obj_marker)
{
    instance_create(0, 0, obj_marker)
    event_user(1)
}

if cur_ind &gt;= gen_size
{
    //add generation
    cur_ind = 0
    cur_gen++
    
    ds_list_add(save[? "generations"], ds_list_create())
    ds_list_mark_as_list(save[? "generations"], cur_gen)
    
    //create guys
    individuals = ds_list_find_value(save[? "generations"], cur_gen)
    
    //get best guys
    var cur;
    for(var i = 0; i &lt; gen_size; i++)
    {
        cur = ds_list_find_value(ds_list_find_value(save[? "generations"], cur_gen-1), i)
        for(var j = 0; j &lt; ds_list_size(individuals)+1; j++)
        {
            if j == ds_list_size(individuals)
            {
                if ds_list_size(individuals) &lt; surivors
                {
                    ds_list_add(individuals, cur)
                    ds_list_mark_as_map(individuals, ds_list_size(individuals)-1)
                }
                break
            }
            else
            if cur[? "score"] &gt; ds_list_find_value(individuals, i)
            {
                ds_list_insert(individuals, i, cur)
                ds_list_mark_as_map(individuals, i)
                
                if ds_list_size(individuals) &gt; surivors
                    ds_list_delete(individuals, surivors)
                
                break
            }
        }
    }    
    
    //make new guys
    var ind_map;
    
    repeat gen_size-surivors
    {
        ind_map = ds_map_create()
        ind_map[? "name"] = get_name()
        ind_map[? "score"] = 0
        
        var p1, p2;
        p1 = irandom(surivors-1)
        
        do       
            p2 = irandom(surivors-1)
        until (p1 != p2)
        
        ind_map[? "genome"] = merge_genes(ds_map_find_value(individuals[| p1], "genome"), ds_map_find_value(individuals[| p2], "genome"))
        
        ds_list_add(individuals, ind_map)
        ds_list_mark_as_map(individuals, ds_list_size(individuals)-1)
    }
    
    //delete old generation
    //ds_list_delete(save[? "generations"], cur_gen-1)
}


input_script = input_dyn_AI

image_blend = c_blue

ai_table = ds_grid_create(ins, outs)

t = 0

//show_error(json_encode(save), 0)

ds_grid_read(ai_table, ds_map_find_value(ds_list_find_value(ds_list_find_value(save[? "generations"], cur_gen), cur_ind), "genome"))

enemy = obj_player.id


</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="1" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>ds_map_replace(ds_list_find_value(ds_list_find_value(save[? "generations"], cur_gen), cur_ind), "score", t)
cur_ind++
room_restart()
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="2">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>event_inherited()
t++

if !instance_exists(enemy)
{
    ds_map_replace(ds_list_find_value(ds_list_find_value(save[? "generations"], cur_gen), cur_ind), "score", 3600-t)
    cur_ind++
    room_restart()
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="11">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>globalvar log, save, cur_gen, cur_ind;
globalvar gen_size, surivors, ins, outs;
ins = 5
outs = 4
gen_size = 10
surivors = 5

save = ds_map_create()
ds_map_add_list(save, "generations", ds_list_create())

cur_gen = 0
cur_ind = 0 


ds_list_add(save[? "generations"], ds_list_create())
ds_list_mark_as_list(save[? "generations"], cur_gen)

individuals = ds_list_find_value(save[? "generations"], cur_gen)

var ind_map;

repeat gen_size
{
    var g = ds_grid_create(ins, outs)

    for(var i = 0; i &lt; ins; i++)
    for(var j = 0; j &lt; outs; j++)
    {
        g[# i, j] = random_range(-1, 1) * 10
    }
    
    ind_map = ds_map_create()
    ind_map[? "name"] = get_name()
    ind_map[? "score"] = 0
    ind_map[? "genome"] = ds_grid_write(g)
    ds_grid_destroy(g)    
    ds_list_add(individuals, ind_map)
    ds_list_mark_as_map(individuals, ds_list_size(individuals)-1)
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="64">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>var str = "";
str += "generation: " + string(cur_gen) + "#"
str += "individual: " + string(cur_ind) + "#"

draw_text(8, 8, str)
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="9" enumb="112">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>clipboard_set_text(json_encode(save))
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="9" enumb="83">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>ini_open(working_directory + "\save.ini")
var str = string_replace_all(json_encode(save), '"', "'");
ini_write_string("save", "json", str)
ini_write_real("save", "cur_gen", cur_gen)
ini_write_real("save", "cur_ind", cur_ind)


ini_close()
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="9" enumb="76">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>ini_open(working_directory + "\save.ini")
ds_map_destroy(save)
save = json_decode(string_replace_all(ini_read_string("save", "json", "{}"), "'", '"'))
//if save == -1
show_error("String: " + string_replace_all(ini_read_string("save", "json", "{}"), "'", '"'), 0)
cur_gen = ini_read_real("save", "cur_gen", 0)
cur_ind = ini_read_real("save", "cur_ind", 0)
ini_close()

room_restart()
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
